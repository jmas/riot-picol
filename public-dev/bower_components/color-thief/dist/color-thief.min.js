!function(){var t=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};t.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},t.prototype.update=function(t){this.context.putImageData(t,0,0)},t.prototype.getPixelCount=function(){return this.width*this.height},t.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},t.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var n=function(){};if(n.prototype.getColor=function(t,n){var r=this.getPalette(t,5,n),e=r[0];return e},n.prototype.getPalette=function(n,r,o){"undefined"==typeof r&&(r=10),"undefined"==typeof o&&(o=10);for(var i,u,a,c,f,s=new t(n),h=s.getImageData(),v=h.data,p=s.getPixelCount(),l=[],g=0;p>g;g+=o)i=4*g,u=v[i+0],a=v[i+1],c=v[i+2],f=v[i+3],f>=125&&(u>250&&a>250&&c>250||l.push([u,a,c]));var d=e.quantize(l,r),b=d.palette();return s.removeCanvas(),b},!r)var r={map:function(t,n){var r={};return n?t.map(function(t,e){return r.index=e,n.call(r,t)}):t.slice()},naturalOrder:function(t,n){return n>t?-1:t>n?1:0},sum:function(t,n){var r={};return t.reduce(n?function(t,e,o){return r.index=o,t+n.call(r,e)}:function(t,n){return t+n},0)},max:function(t,n){return Math.max.apply(null,n?r.map(t,n):t)}};var e=function(){function t(t,n,r){return(t<<2*f)+(n<<f)+r}function n(t){function n(){r.sort(t),e=!0}var r=[],e=!1;return{push:function(t){r.push(t),e=!1},peek:function(t){return e||n(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return e||n(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return e||n(),r}}}function e(t,n,r,e,o,i,u){var a=this;a.r1=t,a.r2=n,a.g1=r,a.g2=e,a.b1=o,a.b2=i,a.histo=u}function o(){this.vboxes=new n(function(t,n){return r.naturalOrder(t.vbox.count()*t.vbox.volume(),n.vbox.count()*n.vbox.volume())})}function i(n){var r,e,o,i,u=1<<3*f,a=new Array(u);return n.forEach(function(n){e=n[0]>>s,o=n[1]>>s,i=n[2]>>s,r=t(e,o,i),a[r]=(a[r]||0)+1}),a}function u(t,n){var r,o,i,u=1e6,a=0,c=1e6,f=0,h=1e6,v=0;return t.forEach(function(t){r=t[0]>>s,o=t[1]>>s,i=t[2]>>s,u>r?u=r:r>a&&(a=r),c>o?c=o:o>f&&(f=o),h>i?h=i:i>v&&(v=i)}),new e(u,a,c,f,h,v,n)}function a(n,e){function o(t){var n,r,o,i,u,a=t+"1",c=t+"2",s=0;for(f=e[a];f<=e[c];f++)if(g[f]>l/2){for(o=e.copy(),i=e.copy(),n=f-e[a],r=e[c]-f,u=r>=n?Math.min(e[c]-1,~~(f+r/2)):Math.max(e[a],~~(f-1-n/2));!g[u];)u++;for(s=d[u];!s&&g[u-1];)s=d[--u];return o[c]=u,i[a]=o[c]+1,[o,i]}}if(e.count()){var i=e.r2-e.r1+1,u=e.g2-e.g1+1,a=e.b2-e.b1+1,c=r.max([i,u,a]);if(1==e.count())return[e.copy()];var f,s,h,v,p,l=0,g=[],d=[];if(c==i)for(f=e.r1;f<=e.r2;f++){for(v=0,s=e.g1;s<=e.g2;s++)for(h=e.b1;h<=e.b2;h++)p=t(f,s,h),v+=n[p]||0;l+=v,g[f]=l}else if(c==u)for(f=e.g1;f<=e.g2;f++){for(v=0,s=e.r1;s<=e.r2;s++)for(h=e.b1;h<=e.b2;h++)p=t(s,f,h),v+=n[p]||0;l+=v,g[f]=l}else for(f=e.b1;f<=e.b2;f++){for(v=0,s=e.r1;s<=e.r2;s++)for(h=e.g1;h<=e.g2;h++)p=t(s,h,f),v+=n[p]||0;l+=v,g[f]=l}return g.forEach(function(t,n){d[n]=l-t}),o(c==i?"r":c==u?"g":"b")}}function c(t,e){function c(t,n){for(var r,e=1,o=0;h>o;)if(r=t.pop(),r.count()){var i=a(f,r),u=i[0],c=i[1];if(!u)return;if(t.push(u),c&&(t.push(c),e++),e>=n)return;if(o++>h)return}else t.push(r),o++}if(!t.length||2>e||e>256)return!1;var f=i(t),s=0;f.forEach(function(){s++});var p=u(t,f),l=new n(function(t,n){return r.naturalOrder(t.count(),n.count())});l.push(p),c(l,v*e);for(var g=new n(function(t,n){return r.naturalOrder(t.count()*t.volume(),n.count()*n.volume())});l.size();)g.push(l.pop());c(g,e-g.size());for(var d=new o;g.size();)d.push(g.pop());return d}var f=5,s=8-f,h=1e3,v=.75;return e.prototype={volume:function(t){var n=this;return(!n._volume||t)&&(n._volume=(n.r2-n.r1+1)*(n.g2-n.g1+1)*(n.b2-n.b1+1)),n._volume},count:function(n){var r=this,e=r.histo;if(!r._count_set||n){var o,i,u,a=0;for(o=r.r1;o<=r.r2;o++)for(i=r.g1;i<=r.g2;i++)for(u=r.b1;u<=r.b2;u++)index=t(o,i,u),a+=e[index]||0;r._count=a,r._count_set=!0}return r._count},copy:function(){var t=this;return new e(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(n){var r=this,e=r.histo;if(!r._avg||n){var o,i,u,a,c,s=0,h=1<<8-f,v=0,p=0,l=0;for(i=r.r1;i<=r.r2;i++)for(u=r.g1;u<=r.g2;u++)for(a=r.b1;a<=r.b2;a++)c=t(i,u,a),o=e[c]||0,s+=o,v+=o*(i+.5)*h,p+=o*(u+.5)*h,l+=o*(a+.5)*h;r._avg=s?[~~(v/s),~~(p/s),~~(l/s)]:[~~(h*(r.r1+r.r2+1)/2),~~(h*(r.g1+r.g2+1)/2),~~(h*(r.b1+r.b2+1)/2)]}return r._avg},contains:function(t){var n=this,r=t[0]>>s;return gval=t[1]>>s,bval=t[2]>>s,r>=n.r1&&r<=n.r2&&gval>=n.g1&&gval<=n.g2&&bval>=n.b1&&bval<=n.b2}},o.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var n=this.vboxes,r=0;r<n.size();r++)if(n.peek(r).vbox.contains(t))return n.peek(r).color;return this.nearest(t)},nearest:function(t){for(var n,r,e,o=this.vboxes,i=0;i<o.size();i++)r=Math.sqrt(Math.pow(t[0]-o.peek(i).color[0],2)+Math.pow(t[1]-o.peek(i).color[1],2)+Math.pow(t[2]-o.peek(i).color[2],2)),(n>r||void 0===n)&&(n=r,e=o.peek(i).color);return e},forcebw:function(){var t=this.vboxes;t.sort(function(t,n){return r.naturalOrder(r.sum(t.color),r.sum(n.color))});var n=t[0].color;n[0]<5&&n[1]<5&&n[2]<5&&(t[0].color=[0,0,0]);var e=t.length-1,o=t[e].color;o[0]>251&&o[1]>251&&o[2]>251&&(t[e].color=[255,255,255])}},{quantize:c}}();if("undefined"!=typeof define)define(function(){return n});else if("undefined"!=typeof module)module.exports=n;else{if("undefined"==typeof window)throw new Error("Can't export ColorThief.");window.ColorThief=n}}();
